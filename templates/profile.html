{% extends "base.html" %}

{% block title %}{{ user.username }} - Profile - StackIt{% endblock %}

{% block breadcrumbs %}
<nav class="container mt-3" aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ user.username }}</li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-3">
        <div class="card">
            <div class="card-body text-center">
                <div class="profile-avatar mb-3">
                    {% if user.username == 'Stellar' %}
                    <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center" 
                         style="width: 80px; height: 80px; font-size: 2rem;">
                        <i class="fas fa-robot"></i>
                    </div>
                    {% else %}
                    <div class="bg-secondary text-white rounded-circle d-inline-flex align-items-center justify-content-center" 
                         style="width: 80px; height: 80px; font-size: 2rem;">
                        {{ user.username[0].upper() }}
                    </div>
                    {% endif %}
                </div>
                <h4>{{ user.username }}</h4>
                {% if user.username == 'Stellar' %}
                <span class="badge bg-primary mb-2">
                    <i class="fas fa-robot me-1"></i>AI Assistant
                </span>
                {% elif user.role == 'admin' %}
                <span class="badge bg-danger mb-2">
                    <i class="fas fa-crown me-1"></i>Administrator
                </span>
                {% endif %}
                <p class="text-muted">{{ user.email }}</p>
                <div class="profile-stats">
                    <div class="row text-center">
                        <div class="col">
                            <div class="fw-bold">{{ user.reputation }}</div>
                            <small class="text-muted">Reputation</small>
                        </div>
                        <div class="col">
                            <div class="fw-bold">{{ questions|length }}</div>
                            <small class="text-muted">Questions</small>
                        </div>
                        <div class="col">
                            <div class="fw-bold">{{ answers|length }}</div>
                            <small class="text-muted">Answers</small>
                        </div>
                    </div>
                </div>
                <div class="mt-3">
                    <small class="text-muted">
                        Member since {{ user.created_at.strftime('%B %Y') }}
                    </small>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-9">
        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs mb-4" id="profileTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="questions-tab" data-bs-toggle="tab" 
                        data-bs-target="#questions" type="button" role="tab">
                    <i class="fas fa-question-circle me-1"></i>
                    Questions ({{ questions|length }})
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="answers-tab" data-bs-toggle="tab" 
                        data-bs-target="#answers" type="button" role="tab">
                    <i class="fas fa-reply me-1"></i>
                    Answers ({{ answers|length }})
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="profileTabsContent">
            <!-- Questions Tab -->
            <div class="tab-pane fade show active" id="questions" role="tabpanel">
                {% if questions %}
                    {% for question in questions %}
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-2 text-center">
                                    <div class="question-stats">
                                        <div class="stat-item">
                                            <span class="stat-number">{{ question.answer_count }}</span>
                                            <span class="stat-label">answers</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-number">{{ question.views }}</span>
                                            <span class="stat-label">views</span>
                                        </div>
                                        {% if question.accepted_answer %}
                                        <div class="stat-item accepted">
                                            <i class="fas fa-check-circle text-success"></i>
                                            <span class="stat-label">accepted</span>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-10">
                                    <h6 class="card-title">
                                        <a href="{{ url_for('question_detail', id=question.id) }}" 
                                           class="text-decoration-none">
                                            {{ question.title }}
                                        </a>
                                    </h6>
                                    <p class="card-text text-muted small">
                                        {{ question.description[:150] }}{% if question.description|length > 150 %}...{% endif %}
                                    </p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="question-tags">
                                            {% for tag in question.tags %}
                                            <span class="badge bg-secondary me-1">{{ tag.name }}</span>
                                            {% endfor %}
                                        </div>
                                        <small class="text-muted">
                                            {{ question.created_at.strftime('%Y-%m-%d %H:%M') }}
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-question-circle text-muted" style="font-size: 3rem;"></i>
                        <h5 class="mt-3 text-muted">No questions yet</h5>
                        <p class="text-muted">
                            {% if current_user == user %}
                                You haven't asked any questions yet.
                            {% else %}
                                {{ user.username }} hasn't asked any questions yet.
                            {% endif %}
                        </p>
                    </div>
                {% endif %}
            </div>

            <!-- Answers Tab -->
            <div class="tab-pane fade" id="answers" role="tabpanel">
                {% if answers %}
                    {% for answer in answers %}
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-auto text-center">
                                    <div class="vote-score">
                                        <div class="fw-bold">{{ answer.score }}</div>
                                        <small class="text-muted">votes</small>
                                    </div>
                                    {% if answer.is_accepted %}
                                    <div class="mt-1">
                                        <i class="fas fa-check-circle text-success" title="Accepted answer"></i>
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="col">
                                    <h6 class="card-title">
                                        <a href="{{ url_for('question_detail', id=answer.question.id) }}" 
                                           class="text-decoration-none">
                                            {{ answer.question.title }}
                                        </a>
                                    </h6>
                                    <p class="card-text text-muted small">
                                        {{ answer.content[:200] }}{% if answer.content|length > 200 %}...{% endif %}
                                    </p>
                                    <small class="text-muted">
                                        Answered {{ answer.created_at.strftime('%Y-%m-%d %H:%M') }}
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-reply text-muted" style="font-size: 3rem;"></i>
                        <h5 class="mt-3 text-muted">No answers yet</h5>
                        <p class="text-muted">
                            {% if current_user == user %}
                                You haven't answered any questions yet.
                            {% else %}
                                {{ user.username }} hasn't answered any questions yet.
                            {% endif %}
                        </p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
